name: Sync Gitee to GitHub

on:
  schedule:
    - cron: '*/30 * * * *'  # 每30分钟运行一次
  workflow_dispatch:  # 允许手动触发

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout GitHub repo
      uses: actions/checkout@v2
      with:
        fetch-depth: 0

    - name: Configure Git
      run: |
        git config user.name github-actions
        git config user.email github-actions@github.com

    - name: Sync Gitee to GitHub
      env:
        GITEE_USERNAME: ${{ secrets.GITEE_USERNAME }}
        GITEE_TOKEN: ${{ secrets.GITEE_TOKEN }}
      run: |
        git remote add gitee https://$GITEE_USERNAME:$GITEE_TOKEN@gitee.com/BuGlandStudio/leaderboard.git
        git fetch gitee
        git merge gitee/master --allow-unrelated-histories
        git push origin main

    - name: Push changes to GitHub
      uses: ad-m/github-push-action@master
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        branch: main
